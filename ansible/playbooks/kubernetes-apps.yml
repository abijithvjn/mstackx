---
- hosts: bastion
  gather_facts: no
  tasks:
    - name: Wait for SSH to come up
      wait_for_connection:
        timeout: 600

- hosts: bastion

  become: yes

  vars_files:
    - "./../vars/main.yml"
  tasks:
    - name: Create development namespace
      command: kubectl create namespace development
      ignore_errors: yes
    - name: Create monitoring Namespace
      command: kubectl create namespace monitoring
      ignore_errors: yes
    - name: Install filebeat
      command: kubectl apply -f filebeat-kubernetes.yaml
      args:
        chdir: /root/mstackx/kubernetes/
    - name: Install guestbook using helm
      command: helm install ./guestbook-0.2.1.tgz
      args:
        chdir: /root/mstackx/charts/
    
